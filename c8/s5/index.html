
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="通过python解决算法和数据结构问题">
      
      
      
      
        <link rel="prev" href="../s4/">
      
      
        <link rel="next" href="../s6/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>8.5. 树再探：图像量化 - python数据结构和算法 - 中文版</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#85-树再探图像量化" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
你当前浏览的版本已不是最新版本，
<a href="../../..">
    <strong>点击这里</strong>
</a>查看最新版本的文档

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="python数据结构和算法 - 中文版" class="md-header__button md-logo" aria-label="python数据结构和算法 - 中文版" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            python数据结构和算法 - 中文版
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              8.5. 树再探：图像量化
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/pythonds-zh-cn/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    python数据结构和算法 - 中文版
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c1/" class="md-tabs__link">
          
  
    
  
  1. 引言

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c2/" class="md-tabs__link">
          
  
    
  
  2. 算法分析

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c3/" class="md-tabs__link">
          
  
    
  
  3. 基本数据结构

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c4/" class="md-tabs__link">
          
  
    
  
  4. 递归

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c5/" class="md-tabs__link">
          
  
    
  
  5. 搜索与排序

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c6/" class="md-tabs__link">
          
  
    
  
  6. 树和树算法

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c7/" class="md-tabs__link">
          
  
    
  
  7. 图和图算法

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  8. 高级主题

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="python数据结构和算法 - 中文版" class="md-nav__button md-logo" aria-label="python数据结构和算法 - 中文版" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    python数据结构和算法 - 中文版
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/pythonds-zh-cn/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    python数据结构和算法 - 中文版
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c1/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    1. 引言
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            1. 引言
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2. 入门
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3. 什么是计算机科学？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4. 什么是编程？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5. 为什么学习数据结构和抽象数据类型？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6. 为什么学习算法？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7. Python基础回顾
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8. 数据入门
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.9. 输入和输出
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.10. 控制结构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.11. 异常处理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.12. 定义函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.13. Python中的面向对象编程：定义类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.14. 总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.15. 关键术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.16. 练习
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c2/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    2. 算法分析
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            2. 算法分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2. 什么是算法分析？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3. 大O表示法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4. 一个字谜检测例子
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.5. Python数据结构的性能
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.6. 列表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.7. 字典
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.8. 总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.9. 关键术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.10. 练习
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c3/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    3. 基本数据结构
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            3. 基本数据结构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.2. 什么是线性结构？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.3. 栈
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.4. 栈的抽象数据类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.5. 用Python实现栈
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.6. 简单的括号匹配
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.7. 符号匹配（一般情况）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.8. 将十进制数转换为二进制数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.9. 中缀、前缀和后缀表达式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.10. 队列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.11. 队列的抽象数据类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.12. 用Python实现队列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.13. 队列模拟：烫手山芋游戏
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.14. 队列模拟：打印任务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.15. 双端队列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.16. 双端队列的抽象数据类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.17. 用Python实现双端队列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.18. 回文检测器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.19. 列表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.20. 无序列表的抽象数据类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.21. 用链表实现无序列表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.22. 有序列表的抽象数据类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.23. 实现有序列表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.24. 总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s25/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.25. 关键词术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s26/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.26. 练习
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c4/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    4. 递归
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            4. 递归
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2. 什么是递归？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.3. 计算一个数列的和
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.4. 递归的三条法则
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.5. 将整数转换为任意进制的字符串
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.6. 栈帧：实现递归
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.7. 递归的可视化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.8. 谢尔宾斯基三角形
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.9. 复杂的递归问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.10. 汉诺塔问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.11. 迷宫探索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.12. 动态规划
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.13. 总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.14. 关键术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.15. 练习
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c5/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    5. 搜索与排序
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            5. 搜索与排序
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.2. 搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.3. 顺序搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.4. 二分搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.5. 哈希
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.6. 排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.7. 冒泡排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.8. 选择排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.9. 插入排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.10. 希尔排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.11. 归并排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.12. 快速排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.13. 总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.14. 关键术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.15. 练习
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c6/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    6. 树和树算法
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            6. 树和树算法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.2. 树的示例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.3. 词汇和定义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.4. 实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.5. 列表表示法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.6. 节点与引用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.7. 解析树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.8. 树遍历
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.9. 使用二叉堆的优先队列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.10. 二叉堆操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.11. 二叉堆实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.12. 二叉搜索树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.13. 搜索树操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.14. 搜索树实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.15. 搜索树分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.16. 平衡二叉搜索树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.17. AVL树性能
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.18. AVL树实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.19. Map ADT实现总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.20. 总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.21. 关键术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.22. 练习
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c7/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    7. 图和图算法
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            7. 图和图算法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.2. 词汇和定义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.3. 图的抽象数据类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.4. 邻接矩阵
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.5. 邻接表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.6. 实现
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.7. 字梯问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.8. 构建字梯图
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.9. 实现广度优先搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.10. 广度优先搜索分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.11. 骑士巡游问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.12. 构建骑士巡游图
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.13. 实现骑士巡游
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.14. 骑士巡游分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s15/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.15. 一般的深度优先搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.16. 深度优先搜索分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s17/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.17. 拓扑排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.18. 强连通分量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s19/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.19. 最短路径问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s20/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.20. Dijkstra算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s21/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.21. Dijkstra算法分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s22/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.22. Prim生成树算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.23. 总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.24. 关键术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s25/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.25. 练习
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    8. 高级主题
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            8. 高级主题
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.1. 目标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.2. Python列表再探
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.3. 递归再探
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.4. 字典再探：跳表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    8.5. 树再探：图像量化
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    8.5. 树再探：图像量化
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#851-数字图像快速回顾" class="md-nav__link">
    8.5.1. 数字图像快速回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#852-图像量化" class="md-nav__link">
    8.5.2. 图像量化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#853-使用八叉树的改进量化算法" class="md-nav__link">
    8.5.3. 使用八叉树的改进量化算法
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.6. 图再探：模式匹配
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#851-数字图像快速回顾" class="md-nav__link">
    8.5.1. 数字图像快速回顾
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#852-图像量化" class="md-nav__link">
    8.5.2. 图像量化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#853-使用八叉树的改进量化算法" class="md-nav__link">
    8.5.3. 使用八叉树的改进量化算法
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="85-树再探图像量化">8.5. 树再探：图像量化<a class="headerlink" href="#85-树再探图像量化" title="Permanent link">&para;</a></h1>
<p><strong>8.5. Trees Revisited: Quantizing Images</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">中文</label><label for="__tabbed_1_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Next to text, digital images are the most common element found on the internet. However, the internet would feel much slower if every advertisement-sized image required 196,560 bytes of memory. Instead, a banner ad image requires only 14,246, just 7.2% of what it could take. Where do these numbers come from? How is such a phenomenal savings achieved? The answers to these questions are the topic of this section.</p>
</div>
<div class="tabbed-block">
<p>Next to text, digital images are the most common element found on the internet. However, the internet would feel much slower if every advertisement-sized image required 196,560 bytes of memory. Instead, a banner ad image requires only 14,246, just 7.2% of what it could take. Where do these numbers come from? How is such a phenomenal savings achieved? The answers to these questions are the topic of this section.</p>
</div>
</div>
</div>
<h2 id="851-数字图像快速回顾">8.5.1. 数字图像快速回顾<a class="headerlink" href="#851-数字图像快速回顾" title="Permanent link">&para;</a></h2>
<p><strong>8.5.1. A Quick Review of Digital Images</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">中文</label><label for="__tabbed_2_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>A digital image is composed of thousands of individual components called
<strong>pixels</strong>. The pixels are arranged as a rectangle that forms the image.
Each pixel in an image represents a particular color in the image. On a
computer, the color of each pixel is determined by a mixture of three
primary colors: red, green, and blue. A simple example of how pixels are
arranged to form a picture is shown in <code>Figure 1</code>.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/8by8image.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/8by8image.png" /></a>
    <figcaption markdown="span">Figure 1: A Simple Image Composed of Pixels</figcaption>
</figure></p>
<p>In the physical world colors are not discrete quantities. The colors in our physical world have an infinite amount of variation to them. Just as computers must approximate floating point numbers, they also must approximate the colors in an image. The human eye can distinguish between 200 different levels in each of the three primary colors, or a total of about 8 million individual colors. In practice we use one byte (8 bits) of memory for each color component of a pixel. Eight bits gives us 256 different levels for each of the red, green, and blue components, for a total of 16.7 million different possible colors for each pixel. While the huge number of colors allows artists and graphic designers to create wonderfully detailed images, the downside of all of these color possibilities is that image size grows very rapidly. For example, a single image from a one-megapixel camera would take 3 megabytes of memory.</p>
<p>In Python we might represent an image using a list of a list of tuples, where the tuples consist of three numbers between 0 and 255, one for each of the red, green, and blue components. In other languages, such as C++ and Java, an image could be represented as a two-dimensional array. The list of lists representation of the first two rows of the image in <code>Figure 1</code> is shown below:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>im <span style="color: #666666">=</span> [[(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),
        (<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),],
        [(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),
        (<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>)],
<span style="color: #666666">...</span> ]
</code></pre></div>
<p>The color white is represented by the tuple <span class="arithmatex">\((255, 255, 255)\)</span>. A bluish color is represented by the tuple <span class="arithmatex">\((12, 28, 255)\)</span>. You can obtain the color value for any pixel in the image by simply using list indices, for example:</p>
<div class="language-pycon highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>im[<span style="color: #666666">3</span>][<span style="color: #666666">2</span>]
<span style="color: #717171">(255, 18, 39)</span>
</code></pre></div>
<p>With this representation for an image in mind, you can imagine that it would be easy to store an image to a file just by writing a tuple for each pixel. You might start by writing the number of rows and columns in the image and then by writing three integer values per line. In practice, the Python package <code>Pillow</code> provides us with some powerful classes. Using the <code>Image</code> class we can get and set pixels using <code>getpixel((col, row))</code> and <code>putpixel((col, row), color)</code>. Note that the parameters for the image methods are in the traditional <span class="arithmatex">\(x, y\)</span> order but many people forget and think in terms of row, column order.</p>
</div>
<div class="tabbed-block">
<p>A digital image is composed of thousands of individual components called
<strong>pixels</strong>. The pixels are arranged as a rectangle that forms the image.
Each pixel in an image represents a particular color in the image. On a
computer, the color of each pixel is determined by a mixture of three
primary colors: red, green, and blue. A simple example of how pixels are
arranged to form a picture is shown in <code>Figure 1</code>.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/8by8image.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/8by8image.png" /></a>
    <figcaption markdown="span">Figure 1: A Simple Image Composed of Pixels</figcaption>
</figure></p>
<p>In the physical world colors are not discrete quantities. The colors in our physical world have an infinite amount of variation to them. Just as computers must approximate floating point numbers, they also must approximate the colors in an image. The human eye can distinguish between 200 different levels in each of the three primary colors, or a total of about 8 million individual colors. In practice we use one byte (8 bits) of memory for each color component of a pixel. Eight bits gives us 256 different levels for each of the red, green, and blue components, for a total of 16.7 million different possible colors for each pixel. While the huge number of colors allows artists and graphic designers to create wonderfully detailed images, the downside of all of these color possibilities is that image size grows very rapidly. For example, a single image from a one-megapixel camera would take 3 megabytes of memory.</p>
<p>In Python we might represent an image using a list of a list of tuples, where the tuples consist of three numbers between 0 and 255, one for each of the red, green, and blue components. In other languages, such as C++ and Java, an image could be represented as a two-dimensional array. The list of lists representation of the first two rows of the image in <code>Figure 1</code> is shown below:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>im <span style="color: #666666">=</span> [[(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),
        (<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),],
        [(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),
        (<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">12</span>,<span style="color: #666666">28</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>),(<span style="color: #666666">255</span>,<span style="color: #666666">255</span>,<span style="color: #666666">255</span>)],
<span style="color: #666666">...</span> ]
</code></pre></div>
<p>The color white is represented by the tuple <span class="arithmatex">\((255, 255, 255)\)</span>. A bluish color is represented by the tuple <span class="arithmatex">\((12, 28, 255)\)</span>. You can obtain the color value for any pixel in the image by simply using list indices, for example:</p>
<div class="language-pycon highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #000080; font-weight: bold">&gt;&gt;&gt; </span>im[<span style="color: #666666">3</span>][<span style="color: #666666">2</span>]
<span style="color: #717171">(255, 18, 39)</span>
</code></pre></div>
<p>With this representation for an image in mind, you can imagine that it would be easy to store an image to a file just by writing a tuple for each pixel. You might start by writing the number of rows and columns in the image and then by writing three integer values per line. In practice, the Python package <code>Pillow</code> provides us with some powerful classes. Using the <code>Image</code> class we can get and set pixels using <code>getpixel((col, row))</code> and <code>putpixel((col, row), color)</code>. Note that the parameters for the image methods are in the traditional <span class="arithmatex">\(x, y\)</span> order but many people forget and think in terms of row, column order.</p>
</div>
</div>
</div>
<h2 id="852-图像量化">8.5.2. 图像量化<a class="headerlink" href="#852-图像量化" title="Permanent link">&para;</a></h2>
<p><strong>8.5.2. Quantizing an Image</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">中文</label><label for="__tabbed_3_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>There are many ways of reducing the storage requirements for an image. One of the easiest ways is to simply use fewer colors. Fewer color choices means fewer bits for each red, green, and blue component, which means reduced memory requirements. In fact, one of the most popular image formats used for images on the World Wide Web uses only 256 colors for an image. Using 256 colors reduces the storage requirements from three bytes per pixel to one byte per pixel.</p>
<p>Right now you are probably asking yourself how to take an image that  may have as many as 16 million colors and reduce it to just 256? The answer is a process called <strong>quantization</strong>. To understand the process of quantization let’s think about colors as a three-dimensional space. Each color can be represented by a point in space where the red component is the <em>x</em> axis, the green component is the <em>y</em> axis, and the blue component is the <em>z</em> axis. We can think of the space of all possible colors as a <span class="arithmatex">\(256 \times 256 \times 256\)</span> cube. The colors closest to the vertex at <span class="arithmatex">\((0, 0, 0)\)</span> are going to be black and dark color shades. The colors closest to the vertex at <span class="arithmatex">\((255, 255, 255)\)</span> are bright and close to white. The colors closest to <span class="arithmatex">\((255, 0, 0)\)</span> are red and so forth.</p>
<p>The simplest way to think about quantizing an image is to imagine taking the <span class="arithmatex">\(256 \times 256 \times 256\)</span> cube and turning it into an <span class="arithmatex">\(8 \times 8 \times 8\)</span> cube. The overall size of the cube stays the same, but now many colors in the old cube are represented by a single color in the new cube. <code>Figure 2</code> shows an example of the quantization just described.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/quantizeCube.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/quantizeCube.png" /></a>
    <figcaption markdown="span">Figure 2: Color Quantization</figcaption>
</figure></p>
<p>We can turn this simple idea of color quantization into the Python program shown in <code>Listing lst_simplequant</code>. The <code>simple_quant</code> algorithm works by mapping the color components for each pixel represented by its full 256 bits to the color at the center of the cube in its area. This is easy to do using integer division in Python. In the <code>simple_quant</code> algorithm there are seven distinct values in the red dimension and six distinct values in the green and blue dimensions.</p>
<div class="language-python highlight" style="background: #f8f8f8"><span class="filename">Listing lst_simplequant</span><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">PIL</span> <span style="color: #008000; font-weight: bold">import</span> Image


<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">simple_quant</span>(filename):
    im <span style="color: #666666">=</span> Image<span style="color: #666666">.</span>open(filename)
    w, h <span style="color: #666666">=</span> im<span style="color: #666666">.</span>size
    <span style="color: #008000; font-weight: bold">for</span> row <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h):
        <span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(w):
            r, g, b <span style="color: #666666">=</span> im<span style="color: #666666">.</span>getpixel((col, row))
            r <span style="color: #666666">=</span> r <span style="color: #666666">//</span> <span style="color: #666666">36</span> <span style="color: #666666">*</span> <span style="color: #666666">36</span>
            g <span style="color: #666666">=</span> g <span style="color: #666666">//</span> <span style="color: #666666">42</span> <span style="color: #666666">*</span> <span style="color: #666666">42</span>
            b <span style="color: #666666">=</span> b <span style="color: #666666">//</span> <span style="color: #666666">42</span> <span style="color: #666666">*</span> <span style="color: #666666">42</span>
            im<span style="color: #666666">.</span>putpixel((col, row), (r, g, b))
    im<span style="color: #666666">.</span>show()

simple_quant(<span style="color: #BA2121">&quot;bubbles.jpg&quot;</span>)
</code></pre></div>
<p><code>Figure 2</code> shows a before and after comparison of original and quantized images. Of course, these are color pictures that have been converted to gray scale for publication. You can use any JPEG color image from your collection and run the program to see the real difference in full color. Notice how much detail is lost in the quantized picture. The grass has lost nearly all its detail and is uniformly green, and the skin tones have been reduced to two shades of tan.</p>
</div>
<div class="tabbed-block">
<p>There are many ways of reducing the storage requirements for an image. One of the easiest ways is to simply use fewer colors. Fewer color choices means fewer bits for each red, green, and blue component, which means reduced memory requirements. In fact, one of the most popular image formats used for images on the World Wide Web uses only 256 colors for an image. Using 256 colors reduces the storage requirements from three bytes per pixel to one byte per pixel.</p>
<p>Right now you are probably asking yourself how to take an image that  may have as many as 16 million colors and reduce it to just 256? The answer is a process called <strong>quantization</strong>. To understand the process of quantization let’s think about colors as a three-dimensional space. Each color can be represented by a point in space where the red component is the <em>x</em> axis, the green component is the <em>y</em> axis, and the blue component is the <em>z</em> axis. We can think of the space of all possible colors as a <span class="arithmatex">\(256 \times 256 \times 256\)</span> cube. The colors closest to the vertex at <span class="arithmatex">\((0, 0, 0)\)</span> are going to be black and dark color shades. The colors closest to the vertex at <span class="arithmatex">\((255, 255, 255)\)</span> are bright and close to white. The colors closest to <span class="arithmatex">\((255, 0, 0)\)</span> are red and so forth.</p>
<p>The simplest way to think about quantizing an image is to imagine taking the <span class="arithmatex">\(256 \times 256 \times 256\)</span> cube and turning it into an <span class="arithmatex">\(8 \times 8 \times 8\)</span> cube. The overall size of the cube stays the same, but now many colors in the old cube are represented by a single color in the new cube. <code>Figure 2</code> shows an example of the quantization just described.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/quantizeCube.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/quantizeCube.png" /></a>
    <figcaption markdown="span">Figure 2: Color Quantization</figcaption>
</figure></p>
<p>We can turn this simple idea of color quantization into the Python program shown in <code>Listing lst_simplequant</code>. The <code>simple_quant</code> algorithm works by mapping the color components for each pixel represented by its full 256 bits to the color at the center of the cube in its area. This is easy to do using integer division in Python. In the <code>simple_quant</code> algorithm there are seven distinct values in the red dimension and six distinct values in the green and blue dimensions.</p>
<div class="language-python highlight" style="background: #f8f8f8"><span class="filename">Listing lst_simplequant</span><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">PIL</span> <span style="color: #008000; font-weight: bold">import</span> Image


<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">simple_quant</span>(filename):
    im <span style="color: #666666">=</span> Image<span style="color: #666666">.</span>open(filename)
    w, h <span style="color: #666666">=</span> im<span style="color: #666666">.</span>size
    <span style="color: #008000; font-weight: bold">for</span> row <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h):
        <span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(w):
            r, g, b <span style="color: #666666">=</span> im<span style="color: #666666">.</span>getpixel((col, row))
            r <span style="color: #666666">=</span> r <span style="color: #666666">//</span> <span style="color: #666666">36</span> <span style="color: #666666">*</span> <span style="color: #666666">36</span>
            g <span style="color: #666666">=</span> g <span style="color: #666666">//</span> <span style="color: #666666">42</span> <span style="color: #666666">*</span> <span style="color: #666666">42</span>
            b <span style="color: #666666">=</span> b <span style="color: #666666">//</span> <span style="color: #666666">42</span> <span style="color: #666666">*</span> <span style="color: #666666">42</span>
            im<span style="color: #666666">.</span>putpixel((col, row), (r, g, b))
    im<span style="color: #666666">.</span>show()

simple_quant(<span style="color: #BA2121">&quot;bubbles.jpg&quot;</span>)
</code></pre></div>
<p><code>Figure 2</code> shows a before and after comparison of original and quantized images. Of course, these are color pictures that have been converted to gray scale for publication. You can use any JPEG color image from your collection and run the program to see the real difference in full color. Notice how much detail is lost in the quantized picture. The grass has lost nearly all its detail and is uniformly green, and the skin tones have been reduced to two shades of tan.</p>
</div>
</div>
</div>
<h2 id="853-使用八叉树的改进量化算法">8.5.3. 使用八叉树的改进量化算法<a class="headerlink" href="#853-使用八叉树的改进量化算法" title="Permanent link">&para;</a></h2>
<p><strong>8.5.3. An Improved Quantization Algorithm Using Octrees</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">中文</label><label for="__tabbed_4_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The problem with the simple method of quantization just described is that the colors in most pictures are not evenly distributed throughout the color cube. Many colors may not appear in the image, so parts of the cube may go completely unused. Allocating an unused color to the quantized image is a waste. <code>Figure 3</code> shows the distribution of the colors that are used in the example image. Notice how little of the color cube space is actually used.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/colorcube.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/colorcube.png" /></a>
    <figcaption markdown="span">Figure 3: Plot of Colors Used in Image as Points in Color Cube</figcaption>
</figure>   </p>
<p>To make a better quantized image we need to find a way to do a better job of selecting the set of colors we want to use to represent our image. There are several algorithms for dividing the color cube in different ways to allow for the better use of colors. In this section we are going to look at a tree-based solution. The tree solution we will use makes use of an <strong>octree</strong>. An octree is similar to a binary tree; however, each node in an octree has eight children. Here is the interface we will implement for our octree abstract data type:</p>
<ul>
<li><code>Octree()</code> creates a new empty octree.</li>
<li><code>insert(r, g, b)</code> adds a new node to the octree using the red, green, and blue color values as the key.</li>
<li><code>find(r, g, b)</code> finds an existing node, or the closest approximation, using the red, green, and blue color values as the search key.</li>
<li><code>reduce(n)</code> reduces the size of the octree so that there are <span class="arithmatex">\(n\)</span> or fewer leaf nodes.</li>
</ul>
<p>Here is how an octree is used to divide the color cube:</p>
<ul>
<li>The root of the octree represents the entire cube.</li>
<li>The second level of the octree represents a single slice through each dimension (<span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(y\)</span>, and <span class="arithmatex">\(z\)</span>) that evenly divides the cube into eight pieces.</li>
<li>The next level of the tree divides each of the eight sub-cubes into eight additional cubes for a total of 64 cubes. Notice that the cube represented by the parent node totally contains all of the sub-cubes represented by the children. As we follow any path down the tree we are staying within the boundary of the parent, but getting progressively more specific about the portion of the cube.</li>
<li>The eighth level of the tree represents the full resolution of 16.7 million colors in our color cube.</li>
</ul>
<p>Now that you know how we can represent the color cube using an octree, you may be thinking that the octree is just another way to divide up the color cube into even parts. You are correct. However, because the octree is hierarchical, we can take advantage of the hierarchy to use larger cubes to represent unused portions of the color cube and smaller cubes to represent the popular colors. Here is an overview of how we will use an octree to do a better job of selecting a subset of the colors in an image:</p>
<ol>
<li>
<p>For each pixel in the image:</p>
<ol>
<li>Search for the color of this pixel in the octree. The colo will be a leaf node at the eighth level.</li>
<li>If the color is not found create a new leaf node at the eighth level (and possibly some internal nodes above the leaf).</li>
<li>If the color is already present in the tree increment the counter in the leaf node to keep track of how many pixels are this color.</li>
</ol>
</li>
<li>
<p>Repeat until the number of leaf nodes is less than or equal to the target number of colors.</p>
<ol>
<li>Find the deepest leaf node with the smallest number of uses.</li>
<li>Merge the leaf node and all of its siblings together to form a new leaf node.</li>
</ol>
</li>
<li>
<p>The remaining leaf nodes form the color set for this image.</p>
</li>
<li>
<p>To map an original color to its quantized value simply search down the tree until you get to a leaf node. Return the color values stored in the leaf.</p>
</li>
</ol>
<p>The ideas outlined above are encoded as a Python function to read, quantize, and display an image in the function <code>build_and_display()</code> in <code>Listing lst_bad</code>.</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_bad</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">build_and_display</span>(filename):
    img <span style="color: #666666">=</span> Image<span style="color: #666666">.</span>open(filename)
    w, h <span style="color: #666666">=</span> img<span style="color: #666666">.</span>size
    ot <span style="color: #666666">=</span> Octree()
    <span style="color: #008000; font-weight: bold">for</span> row <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h):
        <span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(w):
            r, g, b <span style="color: #666666">=</span> img<span style="color: #666666">.</span>getpixel((col, row))
            ot<span style="color: #666666">.</span>insert(r, g, b)
    ot<span style="color: #666666">.</span>reduce(<span style="color: #666666">256</span>)

    <span style="color: #008000; font-weight: bold">for</span> row <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h):
        <span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(w):
            r, g, b <span style="color: #666666">=</span> img<span style="color: #666666">.</span>getpixel((col, row))
            nr, ng, nb <span style="color: #666666">=</span> ot<span style="color: #666666">.</span>find(r, g, b)
            img<span style="color: #666666">.</span>putpixel((col, row), (nr, ng, nb))
    img<span style="color: #666666">.</span>show()
</code></pre></div></td></tr></table></div>
<p>The <code>build_and_display</code> function follows the basic process just described. First, the loops in lines 5–8 read each pixel and add it to the octree. Second, the number of leaf nodes is reduced by the <code>reduce</code> method on line 9. Finally, the image is updated by searching for a color, using <code>find</code>, in the reduced octree on line 14.</p>
<p>We are using the Python image library to open an existing image file (<code>Image.open</code>), read a pixel (<code>getpixel</code>), write a pixel (<code>putpixel</code>), and display the result to the screen (<code>show</code>). <code>build_and_display</code> interacts with the octree using an instance of the <code>Octree</code> class (<code>Listing lst_octreedef</code>).</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_octreedef</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">17</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">18</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">19</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">20</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">21</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">22</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">23</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">24</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">25</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">26</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">27</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">28</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">29</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">30</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">31</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">32</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">33</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">34</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">35</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">36</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">octree</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>root <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>max_level <span style="color: #666666">=</span> <span style="color: #666666">5</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>num_leaves <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves <span style="color: #666666">=</span> []

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">insert</span>(<span style="color: #008000">self</span>, r, g, b):
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>root:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>root <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>OTNode(outer<span style="color: #666666">=</span><span style="color: #008000">self</span>)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>root<span style="color: #666666">.</span>insert(r, g, b, <span style="color: #666666">0</span>, <span style="color: #008000">self</span>)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">find</span>(<span style="color: #008000">self</span>, r, g, b):
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>root:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>root<span style="color: #666666">.</span>find(r, g, b, <span style="color: #666666">0</span>)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">reduce</span>(<span style="color: #008000">self</span>, max_cubes):   <span style="color: #3D7B7B; font-style: italic"># line_otreduce</span>
        <span style="color: #008000; font-weight: bold">while</span> <span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves) <span style="color: #666666">&gt;</span> max_cubes:
            smallest <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>find_min_cube()
            smallest<span style="color: #666666">.</span>parent<span style="color: #666666">.</span>merge()  <span style="color: #3D7B7B; font-style: italic"># line_otredmerge</span>
            <span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves<span style="color: #666666">.</span>append(smallest<span style="color: #666666">.</span>parent)
            <span style="color: #008000">self</span><span style="color: #666666">.</span>num_leaves <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>num_leaves <span style="color: #666666">+</span> <span style="color: #666666">1</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">find_min_cube</span>(<span style="color: #008000">self</span>):
        min_count <span style="color: #666666">=</span> sys<span style="color: #666666">.</span>maxsize
        max_level <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        min_cube <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>
        <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves:
            <span style="color: #008000; font-weight: bold">if</span> (
                i<span style="color: #666666">.</span>count <span style="color: #666666">&lt;=</span> min_count
                <span style="color: #AA22FF; font-weight: bold">and</span> i<span style="color: #666666">.</span>level <span style="color: #666666">&gt;=</span> max_level
            ):
                min_cube <span style="color: #666666">=</span> i
                min_count <span style="color: #666666">=</span> i<span style="color: #666666">.</span>count
                max_level <span style="color: #666666">=</span> i<span style="color: #666666">.</span>level
        <span style="color: #008000; font-weight: bold">return</span> min_cube
</code></pre></div></td></tr></table></div>
<p>First notice that the constructor for an <code>Octree</code> initializes the root node to <code>None</code>. Then it sets up three important attributes that all the nodes of an octree may need to access. Those attributes are <code>max_level</code>, <code>num_leaves</code>, and <code>all_leaves</code>. The <code>max_level</code> attribute limits the total depth of the tree. Notice that in our implementation we have initialized <code>max_level</code> to five. This is a small optimization that simply allows us to ignore the two least significant bits of color information. It keeps the overall size of the tree much smaller and doesn’t hurt the quality of the final image at all. The <code>num_leaves</code> and <code>all_leaves</code> attributes allow us to keep track of the number of leaf nodes and allow us direct access to the leaves without traversing all the way down the tree. We will see why this is important shortly.</p>
<p>The <code>insert</code> and <code>find</code> methods behave exactly like their cousins in chapter <a href="../../c6/">chap_tree</a>. They each check to see if a root node exists, and then call the corresponding method in the root node. Notice that <code>insert</code> and <code>find</code> both use the red, green, and blue components (<code>(r, g, b)</code>) to identify a node in the tree.</p>
<p>The <code>reduce</code> method is defined on line <code>[lst_octreedef:line_otreduce]</code> of <code>Listing lst_octreedef</code>. This method simply loops until the number of leaves in the leaf list is less than the total number of colors we want to have in the final image (defined by the parameter <code>max_cubes</code>). <code>reduce</code> makes use of a helper function <code>find_min_cube</code> to find the node in the octree with the smallest reference count. Once the node with the smallest reference count is found, that node is merged into a single node with all of its siblings (see line <code>[lst_octreedef:line_otredmerge]</code>).</p>
<p>The <code>find_min_cube</code> method is implemented using the <code>all_leaves</code> and a simple find minimum loop pattern. When the number of leaf nodes is large, and it could be as large is 16.7 million, this approach is not very efficient. In one of the exercises you are asked to modify the <code>Octree</code> class and improve the efficiency of <code>find_min_cube</code>.</p>
<p>One of the things to mention about the <code>Octree</code> class is that it uses an instance of the class <code>OTNode</code> which is defined inside the the <code>Octree</code> class. A class that is defined inside another class is called an <em>inner class</em>. We define <code>OTNode</code> inside <code>Octree</code> because each node of an octree needs to have access to some information that is stored in an instance of the <code>Octree</code> class. Another reason for making <code>OTNode</code> an inner class is that there is no reason for any code outside of the <code>Octree</code> class to use it. The way that an octree is implemented is really a private detail that nobody else needs to know about. This is a good software engineering practice known as <em>information hiding</em>.</p>
<p>Now let’s look at the class definition for the nodes in an octree (<code>Listing lst_otnodedef</code>). The constructor for the <code>OTNode</code> class has three optional parameters: <code>parent</code>, <code>level</code>, and <code>outer</code>. These parameters allow the <code>Octree</code> methods to construct new nodes under a variety of circumstances. As we did with binary search trees, we will keep track of the parent of a node explicitly. The level of the node simply indicates its depth in the tree. The most interesting of these three parameters is the <code>outer</code> parameter, which is a reference to the instance of the <code>octree</code> class that created this node. <code>outer</code> will function like <code>self</code> in that it will allow the instances of <code>OTNode</code> to access attributes of an instance of <code>Octree</code>.</p>
<p>The other attributes that we want to remember about each node in an <code>octree</code> include the reference <code>count</code> and the red, green, and blue components of the color represented by this tree. As you will note in the <code>insert</code> function, only a leaf node of the tree will have values for <code>red</code>, <code>green</code>, <code>blue</code>, and <code>count</code>. Also note that since each node can have up to eight children we initialize a list of eight references to keep track of them all. Rather than a left and right child as in binary trees, an octree has 0–7 children.</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_otnodedef</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">OTNode</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, parent<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>, level<span style="color: #666666">=0</span>, outer<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>parent <span style="color: #666666">=</span> parent
        <span style="color: #008000">self</span><span style="color: #666666">.</span>level <span style="color: #666666">=</span> level
        <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree <span style="color: #666666">=</span> outer
        <span style="color: #008000">self</span><span style="color: #666666">.</span>children <span style="color: #666666">=</span> [<span style="color: #008000; font-weight: bold">None</span>] <span style="color: #666666">*</span> <span style="color: #666666">8</span>
</code></pre></div></td></tr></table></div>
<p>Now we get into the really interesting parts of the octree implementation. The Python code for inserting a new node into an octree is shown in <code>Listing lst_otninsert</code>. The first problem we need to solve is how to figure out where to place a new node in the tree. In a binary search tree we used the rule that a new node with a key less than its parent went in the left subtree, and a new node with a key greater than its parent went in the right subtree. But with eight possible children for each node it is not that simple. In addition, when indexing colors it is not obvious what the key for each node should be. In an <code>octree</code> we will use the information from the three color components. <code>Figure 4</code> shows how we can use the red, green, and blue color values to compute an index for the position of the new node at each level of the tree. The corresponding Python code for computing the index is on line <code>line_otci</code> of <code>Listing lst_otninsert</code>.</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_otninsert</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">17</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">18</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">19</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">20</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">21</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">22</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">23</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">24</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">25</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">26</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">27</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">28</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">29</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">30</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">31</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">insert</span>(<span style="color: #008000">self</span>, r, g, b, level, outer):
    <span style="color: #008000; font-weight: bold">if</span> level <span style="color: #666666">&lt;</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>max_level:
        idx <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>compute_index(
            r, g, b, level
        )
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx] <span style="color: #666666">==</span> <span style="color: #008000; font-weight: bold">None</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx] <span style="color: #666666">=</span> outer<span style="color: #666666">.</span>OTNode(
                parent<span style="color: #666666">=</span><span style="color: #008000">self</span>,
                level<span style="color: #666666">=</span>level <span style="color: #666666">+</span> <span style="color: #666666">1</span>,
                outer<span style="color: #666666">=</span>outer,
            )
        <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx]<span style="color: #666666">.</span>insert(
            r, g, b, level <span style="color: #666666">+</span> <span style="color: #666666">1</span>, outer
        )
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">==</span> <span style="color: #666666">0</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>num_leaves <span style="color: #666666">=</span> (
                <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>num_leaves <span style="color: #666666">+</span> <span style="color: #666666">1</span>
            )
            <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>all_leaves<span style="color: #666666">.</span>append(<span style="color: #008000">self</span>)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">+=</span> r
        <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">+=</span> g
        <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">+=</span> b
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">+</span> <span style="color: #666666">1</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute_index</span>(<span style="color: #008000">self</span>, r, g, b, l):  <span style="color: #3D7B7B; font-style: italic"># line_otci</span>
    shift <span style="color: #666666">=</span> <span style="color: #666666">8</span> <span style="color: #666666">-</span> l
    rc <span style="color: #666666">=</span> r <span style="color: #666666">&gt;&gt;</span> shift <span style="color: #666666">-</span> <span style="color: #666666">2</span> <span style="color: #666666">&amp;</span> <span style="color: #666666">0x4</span>
    gc <span style="color: #666666">=</span> g <span style="color: #666666">&gt;&gt;</span> shift <span style="color: #666666">-</span> <span style="color: #666666">1</span> <span style="color: #666666">&amp;</span> <span style="color: #666666">0x2</span>
    bc <span style="color: #666666">=</span> b <span style="color: #666666">&gt;&gt;</span> shift <span style="color: #666666">&amp;</span> <span style="color: #666666">0x1</span>
    <span style="color: #008000; font-weight: bold">return</span> rc <span style="color: #666666">|</span> gc <span style="color: #666666">|</span> bc
</code></pre></div></td></tr></table></div>
<p>The computation of the index combines bits from each of the red, green, and blue color components, starting at the top of the tree with the highest order bits. <code>Figure 4</code> shows the binary representation of the red, green, and blue components of 163, 98, 231. At the root of the tree we start with the most significant bit from each of the three color components; in this case the three bits are 1, 0, and 1. Putting these bits together we get binary 101 or decimal 5. You can see the binary manipulation of the red, green, and blue numbers in the <code>compute_index</code> method on line <code>line_otci</code> in <code>Listing lst_otninsert</code>.</p>
<p>The operators used in the <code>compute_index</code> may be unfamiliar to you. The <code>&gt;&gt;</code> operator is the right shift operation. The <code>&amp;</code> is bitwise <code>and</code>, and <code>|</code> is logical <code>or</code>. The bitwise <code>or</code> and bitwise <code>and</code> operations work just like the logical operations used in conditionals, except that they work on the individual bits of a number. The shift operation simply moves the bits <span class="arithmatex">\(n\)</span> places to the right, filling in with zeros on the left and dropping the bits as they go off the right.</p>
<p>Once we have computed the index appropriate for the current level of the tree, we traverse down into the subtree. In the example in <code>Figure 4</code> we follow the link at position 5 in the <code>children</code> array. If there is no node at position 5, we create one. We keep traversing down the tree until we get to <code>max_level</code>. At <code>max_level</code> we stop searching and store the data. Notice that we do not overwrite the data in the leaf node, but rather we add the color components to any existing components and increment the reference counter. This allows us to compute the average of any color below the current node in the color cube. In this way, a leaf node in the <code>octree</code> may represent a number of similar colors in the color cube.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/octreeIndex.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/octreeIndex.png" /></a>
    <figcaption markdown="span">Figure 4: Computing an Index to Insert a Node in an octree</figcaption>
</figure></p>
<p>The <code>find</code> method, shown in <code>Listing lst_otnfind</code>, uses the same method of index computation as the <code>insert</code> method to traverse the tree in search of a node matching the red, green, and blue components. </p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_otnfind</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">17</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">18</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">19</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">20</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">21</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">find</span>(<span style="color: #008000">self</span>, r, g, b, level):
    <span style="color: #008000; font-weight: bold">if</span> level <span style="color: #666666">&lt;</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>max_level:
        idx <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>compute_index(r, g, b, level)
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx]:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx]<span style="color: #666666">.</span>find(
                r, g, b, level <span style="color: #666666">+</span> <span style="color: #666666">1</span>
            )
        <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
            <span style="color: #008000; font-weight: bold">return</span> (
                <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
                <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
                <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
            )
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot;No leaf node to represent this color&quot;</span>)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">return</span> (
            <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
            <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
            <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
        )
</code></pre></div></td></tr></table></div>
<p>The <code>find</code> method has three exit conditions:</p>
<ol>
<li>We have reached the maximum level of the tree and so we return the average of the color information stored in this leaf node (see lines 17--21).</li>
<li>We have found a leaf node at a height less than <code>max_level</code> (see lines 9--13). This is possible only after the tree has been reduced. See below.</li>
<li>We try to follow a path into a nonexistent subtree, which is an error.</li>
</ol>
<p>The final aspect of the <code>OTNode</code> class is the <code>merge</code> method. It allows a parent to subsume all of its children and become a leaf node itself. If you remember back to the structure of the <code>octree</code> where each parent cube fully encloses all the cubes represented by the children, you will see why this makes sense. When we merge a group of siblings we are effectively taking a weighted average of the colors represented by each of those siblings. Since all the siblings are relatively close to each other in color space, the average is a good representation of all of them. <code>Figure 5</code> illustrates the merge process for some sibling nodes.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/otMerge.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/otMerge.png" /></a>
    <figcaption markdown="span">Figure 5: Merging Four Leaf Nodes of an <code>octree</code></figcaption>
</figure></p>
<p><code>Figure 5</code> shows the red, green, and blue components represented by the four leaf nodes whose identifying color values are (101, 122, 167), (100, 122, 183), (123, 108, 163), and (126, 113, 166). As you can see in <code>Listing lst_otnfind</code>the identifying values are calculated dividing the color values by the count. Notice how close they are in the overall color space. The leaf node that gets created from all of these has an ID of (112, 115, 168). This is close to the average of the four, but weighted more towards the third color tuple due to the fact that it had a reference count of 12.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">merge</span>(<span style="color: #008000">self</span>):
    <span style="color: #008000; font-weight: bold">for</span> child <span style="color: #AA22FF; font-weight: bold">in</span> [c <span style="color: #008000; font-weight: bold">for</span> c <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children <span style="color: #008000; font-weight: bold">if</span> c]:
        <span style="color: #008000; font-weight: bold">if</span> child<span style="color: #666666">.</span>count <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>o_tree<span style="color: #666666">.</span>all_leaves<span style="color: #666666">.</span>remove(child)
            <span style="color: #008000">self</span><span style="color: #666666">.</span>o_tree<span style="color: #666666">.</span>num_leaves <span style="color: #666666">-=</span> <span style="color: #666666">1</span>
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot;Recursively merging non-leaf...&quot;</span>)
            child<span style="color: #666666">.</span>merge()
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>count
        <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>red
        <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>green
        <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>blue
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">8</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>children[i] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>
</code></pre></div>
<p>Because the <code>octree</code> uses only colors that are really present in the image and faithfully preserves colors that are often used, the final quantized image from the <code>octree</code> is much higher quality than the simple method we used to start this section. <code>Figure 2</code> shows a comparison of the original image with the quantized image.</p>
<p>There are many additional ways to compress images using techniques such as run-length encoding, discrete cosine transform, and Huffman coding. Any of these algorithms are within your grasp and we encourage you to look them up and read about them. In addition, quantized images can be improved by using a technique known as <strong>dithering</strong>. Dithering is a process by which different colors are placed near each other so that the eye blends the colors together, forming a more realistic image. This is an old trick used by newspapers for doing color printing using just black plus three different colors of ink. Again you can research dithering and try to apply it to some images on your own.</p>
</div>
<div class="tabbed-block">
<p>The problem with the simple method of quantization just described is that the colors in most pictures are not evenly distributed throughout the color cube. Many colors may not appear in the image, so parts of the cube may go completely unused. Allocating an unused color to the quantized image is a waste. <code>Figure 3</code> shows the distribution of the colors that are used in the example image. Notice how little of the color cube space is actually used.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/colorcube.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/colorcube.png" /></a>
    <figcaption markdown="span">Figure 3: Plot of Colors Used in Image as Points in Color Cube</figcaption>
</figure>   </p>
<p>To make a better quantized image we need to find a way to do a better job of selecting the set of colors we want to use to represent our image. There are several algorithms for dividing the color cube in different ways to allow for the better use of colors. In this section we are going to look at a tree-based solution. The tree solution we will use makes use of an <strong>octree</strong>. An octree is similar to a binary tree; however, each node in an octree has eight children. Here is the interface we will implement for our octree abstract data type:</p>
<ul>
<li><code>Octree()</code> creates a new empty octree.</li>
<li><code>insert(r, g, b)</code> adds a new node to the octree using the red, green, and blue color values as the key.</li>
<li><code>find(r, g, b)</code> finds an existing node, or the closest approximation, using the red, green, and blue color values as the search key.</li>
<li><code>reduce(n)</code> reduces the size of the octree so that there are <span class="arithmatex">\(n\)</span> or fewer leaf nodes.</li>
</ul>
<p>Here is how an octree is used to divide the color cube:</p>
<ul>
<li>The root of the octree represents the entire cube.</li>
<li>The second level of the octree represents a single slice through each dimension (<span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(y\)</span>, and <span class="arithmatex">\(z\)</span>) that evenly divides the cube into eight pieces.</li>
<li>The next level of the tree divides each of the eight sub-cubes into eight additional cubes for a total of 64 cubes. Notice that the cube represented by the parent node totally contains all of the sub-cubes represented by the children. As we follow any path down the tree we are staying within the boundary of the parent, but getting progressively more specific about the portion of the cube.</li>
<li>The eighth level of the tree represents the full resolution of 16.7 million colors in our color cube.</li>
</ul>
<p>Now that you know how we can represent the color cube using an octree, you may be thinking that the octree is just another way to divide up the color cube into even parts. You are correct. However, because the octree is hierarchical, we can take advantage of the hierarchy to use larger cubes to represent unused portions of the color cube and smaller cubes to represent the popular colors. Here is an overview of how we will use an octree to do a better job of selecting a subset of the colors in an image:</p>
<ol>
<li>
<p>For each pixel in the image:</p>
<ol>
<li>Search for the color of this pixel in the octree. The colo will be a leaf node at the eighth level.</li>
<li>If the color is not found create a new leaf node at the eighth level (and possibly some internal nodes above the leaf).</li>
<li>If the color is already present in the tree increment the counter in the leaf node to keep track of how many pixels are this color.</li>
</ol>
</li>
<li>
<p>Repeat until the number of leaf nodes is less than or equal to the target number of colors.</p>
<ol>
<li>Find the deepest leaf node with the smallest number of uses.</li>
<li>Merge the leaf node and all of its siblings together to form a new leaf node.</li>
</ol>
</li>
<li>
<p>The remaining leaf nodes form the color set for this image.</p>
</li>
<li>
<p>To map an original color to its quantized value simply search down the tree until you get to a leaf node. Return the color values stored in the leaf.</p>
</li>
</ol>
<p>The ideas outlined above are encoded as a Python function to read, quantize, and display an image in the function <code>build_and_display()</code> in <code>Listing lst_bad</code>.</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_bad</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">build_and_display</span>(filename):
    img <span style="color: #666666">=</span> Image<span style="color: #666666">.</span>open(filename)
    w, h <span style="color: #666666">=</span> img<span style="color: #666666">.</span>size
    ot <span style="color: #666666">=</span> Octree()
    <span style="color: #008000; font-weight: bold">for</span> row <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h):
        <span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(w):
            r, g, b <span style="color: #666666">=</span> img<span style="color: #666666">.</span>getpixel((col, row))
            ot<span style="color: #666666">.</span>insert(r, g, b)
    ot<span style="color: #666666">.</span>reduce(<span style="color: #666666">256</span>)

    <span style="color: #008000; font-weight: bold">for</span> row <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h):
        <span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(w):
            r, g, b <span style="color: #666666">=</span> img<span style="color: #666666">.</span>getpixel((col, row))
            nr, ng, nb <span style="color: #666666">=</span> ot<span style="color: #666666">.</span>find(r, g, b)
            img<span style="color: #666666">.</span>putpixel((col, row), (nr, ng, nb))
    img<span style="color: #666666">.</span>show()
</code></pre></div></td></tr></table></div>
<p>The <code>build_and_display</code> function follows the basic process just described. First, the loops in lines 5–8 read each pixel and add it to the octree. Second, the number of leaf nodes is reduced by the <code>reduce</code> method on line 9. Finally, the image is updated by searching for a color, using <code>find</code>, in the reduced octree on line 14.</p>
<p>We are using the Python image library to open an existing image file (<code>Image.open</code>), read a pixel (<code>getpixel</code>), write a pixel (<code>putpixel</code>), and display the result to the screen (<code>show</code>). <code>build_and_display</code> interacts with the octree using an instance of the <code>Octree</code> class (<code>Listing lst_octreedef</code>).</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_octreedef</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">17</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">18</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">19</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">20</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">21</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">22</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">23</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">24</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">25</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">26</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">27</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">28</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">29</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">30</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">31</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">32</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">33</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">34</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">35</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">36</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">octree</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>root <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>max_level <span style="color: #666666">=</span> <span style="color: #666666">5</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>num_leaves <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves <span style="color: #666666">=</span> []

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">insert</span>(<span style="color: #008000">self</span>, r, g, b):
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>root:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>root <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>OTNode(outer<span style="color: #666666">=</span><span style="color: #008000">self</span>)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>root<span style="color: #666666">.</span>insert(r, g, b, <span style="color: #666666">0</span>, <span style="color: #008000">self</span>)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">find</span>(<span style="color: #008000">self</span>, r, g, b):
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>root:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>root<span style="color: #666666">.</span>find(r, g, b, <span style="color: #666666">0</span>)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">reduce</span>(<span style="color: #008000">self</span>, max_cubes):   <span style="color: #3D7B7B; font-style: italic"># line_otreduce</span>
        <span style="color: #008000; font-weight: bold">while</span> <span style="color: #008000">len</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves) <span style="color: #666666">&gt;</span> max_cubes:
            smallest <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>find_min_cube()
            smallest<span style="color: #666666">.</span>parent<span style="color: #666666">.</span>merge()  <span style="color: #3D7B7B; font-style: italic"># line_otredmerge</span>
            <span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves<span style="color: #666666">.</span>append(smallest<span style="color: #666666">.</span>parent)
            <span style="color: #008000">self</span><span style="color: #666666">.</span>num_leaves <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>num_leaves <span style="color: #666666">+</span> <span style="color: #666666">1</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">find_min_cube</span>(<span style="color: #008000">self</span>):
        min_count <span style="color: #666666">=</span> sys<span style="color: #666666">.</span>maxsize
        max_level <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        min_cube <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>
        <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>all_leaves:
            <span style="color: #008000; font-weight: bold">if</span> (
                i<span style="color: #666666">.</span>count <span style="color: #666666">&lt;=</span> min_count
                <span style="color: #AA22FF; font-weight: bold">and</span> i<span style="color: #666666">.</span>level <span style="color: #666666">&gt;=</span> max_level
            ):
                min_cube <span style="color: #666666">=</span> i
                min_count <span style="color: #666666">=</span> i<span style="color: #666666">.</span>count
                max_level <span style="color: #666666">=</span> i<span style="color: #666666">.</span>level
        <span style="color: #008000; font-weight: bold">return</span> min_cube
</code></pre></div></td></tr></table></div>
<p>First notice that the constructor for an <code>Octree</code> initializes the root node to <code>None</code>. Then it sets up three important attributes that all the nodes of an octree may need to access. Those attributes are <code>max_level</code>, <code>num_leaves</code>, and <code>all_leaves</code>. The <code>max_level</code> attribute limits the total depth of the tree. Notice that in our implementation we have initialized <code>max_level</code> to five. This is a small optimization that simply allows us to ignore the two least significant bits of color information. It keeps the overall size of the tree much smaller and doesn’t hurt the quality of the final image at all. The <code>num_leaves</code> and <code>all_leaves</code> attributes allow us to keep track of the number of leaf nodes and allow us direct access to the leaves without traversing all the way down the tree. We will see why this is important shortly.</p>
<p>The <code>insert</code> and <code>find</code> methods behave exactly like their cousins in chapter <a href="../../c6/">chap_tree</a>. They each check to see if a root node exists, and then call the corresponding method in the root node. Notice that <code>insert</code> and <code>find</code> both use the red, green, and blue components (<code>(r, g, b)</code>) to identify a node in the tree.</p>
<p>The <code>reduce</code> method is defined on line <code>[lst_octreedef:line_otreduce]</code> of <code>Listing lst_octreedef</code>. This method simply loops until the number of leaves in the leaf list is less than the total number of colors we want to have in the final image (defined by the parameter <code>max_cubes</code>). <code>reduce</code> makes use of a helper function <code>find_min_cube</code> to find the node in the octree with the smallest reference count. Once the node with the smallest reference count is found, that node is merged into a single node with all of its siblings (see line <code>[lst_octreedef:line_otredmerge]</code>).</p>
<p>The <code>find_min_cube</code> method is implemented using the <code>all_leaves</code> and a simple find minimum loop pattern. When the number of leaf nodes is large, and it could be as large is 16.7 million, this approach is not very efficient. In one of the exercises you are asked to modify the <code>Octree</code> class and improve the efficiency of <code>find_min_cube</code>.</p>
<p>One of the things to mention about the <code>Octree</code> class is that it uses an instance of the class <code>OTNode</code> which is defined inside the the <code>Octree</code> class. A class that is defined inside another class is called an <em>inner class</em>. We define <code>OTNode</code> inside <code>Octree</code> because each node of an octree needs to have access to some information that is stored in an instance of the <code>Octree</code> class. Another reason for making <code>OTNode</code> an inner class is that there is no reason for any code outside of the <code>Octree</code> class to use it. The way that an octree is implemented is really a private detail that nobody else needs to know about. This is a good software engineering practice known as <em>information hiding</em>.</p>
<p>Now let’s look at the class definition for the nodes in an octree (<code>Listing lst_otnodedef</code>). The constructor for the <code>OTNode</code> class has three optional parameters: <code>parent</code>, <code>level</code>, and <code>outer</code>. These parameters allow the <code>Octree</code> methods to construct new nodes under a variety of circumstances. As we did with binary search trees, we will keep track of the parent of a node explicitly. The level of the node simply indicates its depth in the tree. The most interesting of these three parameters is the <code>outer</code> parameter, which is a reference to the instance of the <code>octree</code> class that created this node. <code>outer</code> will function like <code>self</code> in that it will allow the instances of <code>OTNode</code> to access attributes of an instance of <code>Octree</code>.</p>
<p>The other attributes that we want to remember about each node in an <code>octree</code> include the reference <code>count</code> and the red, green, and blue components of the color represented by this tree. As you will note in the <code>insert</code> function, only a leaf node of the tree will have values for <code>red</code>, <code>green</code>, <code>blue</code>, and <code>count</code>. Also note that since each node can have up to eight children we initialize a list of eight references to keep track of them all. Rather than a left and right child as in binary trees, an octree has 0–7 children.</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_otnodedef</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">OTNode</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, parent<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>, level<span style="color: #666666">=0</span>, outer<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">=</span> <span style="color: #666666">0</span>
        <span style="color: #008000">self</span><span style="color: #666666">.</span>parent <span style="color: #666666">=</span> parent
        <span style="color: #008000">self</span><span style="color: #666666">.</span>level <span style="color: #666666">=</span> level
        <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree <span style="color: #666666">=</span> outer
        <span style="color: #008000">self</span><span style="color: #666666">.</span>children <span style="color: #666666">=</span> [<span style="color: #008000; font-weight: bold">None</span>] <span style="color: #666666">*</span> <span style="color: #666666">8</span>
</code></pre></div></td></tr></table></div>
<p>Now we get into the really interesting parts of the octree implementation. The Python code for inserting a new node into an octree is shown in <code>Listing lst_otninsert</code>. The first problem we need to solve is how to figure out where to place a new node in the tree. In a binary search tree we used the rule that a new node with a key less than its parent went in the left subtree, and a new node with a key greater than its parent went in the right subtree. But with eight possible children for each node it is not that simple. In addition, when indexing colors it is not obvious what the key for each node should be. In an <code>octree</code> we will use the information from the three color components. <code>Figure 4</code> shows how we can use the red, green, and blue color values to compute an index for the position of the new node at each level of the tree. The corresponding Python code for computing the index is on line <code>line_otci</code> of <code>Listing lst_otninsert</code>.</p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_otninsert</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">17</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">18</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">19</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">20</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">21</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">22</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">23</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">24</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">25</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">26</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">27</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">28</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">29</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">30</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">31</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">insert</span>(<span style="color: #008000">self</span>, r, g, b, level, outer):
    <span style="color: #008000; font-weight: bold">if</span> level <span style="color: #666666">&lt;</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>max_level:
        idx <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>compute_index(
            r, g, b, level
        )
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx] <span style="color: #666666">==</span> <span style="color: #008000; font-weight: bold">None</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx] <span style="color: #666666">=</span> outer<span style="color: #666666">.</span>OTNode(
                parent<span style="color: #666666">=</span><span style="color: #008000">self</span>,
                level<span style="color: #666666">=</span>level <span style="color: #666666">+</span> <span style="color: #666666">1</span>,
                outer<span style="color: #666666">=</span>outer,
            )
        <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx]<span style="color: #666666">.</span>insert(
            r, g, b, level <span style="color: #666666">+</span> <span style="color: #666666">1</span>, outer
        )
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">==</span> <span style="color: #666666">0</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>num_leaves <span style="color: #666666">=</span> (
                <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>num_leaves <span style="color: #666666">+</span> <span style="color: #666666">1</span>
            )
            <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>all_leaves<span style="color: #666666">.</span>append(<span style="color: #008000">self</span>)
        <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">+=</span> r
        <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">+=</span> g
        <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">+=</span> b
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">+</span> <span style="color: #666666">1</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute_index</span>(<span style="color: #008000">self</span>, r, g, b, l):  <span style="color: #3D7B7B; font-style: italic"># line_otci</span>
    shift <span style="color: #666666">=</span> <span style="color: #666666">8</span> <span style="color: #666666">-</span> l
    rc <span style="color: #666666">=</span> r <span style="color: #666666">&gt;&gt;</span> shift <span style="color: #666666">-</span> <span style="color: #666666">2</span> <span style="color: #666666">&amp;</span> <span style="color: #666666">0x4</span>
    gc <span style="color: #666666">=</span> g <span style="color: #666666">&gt;&gt;</span> shift <span style="color: #666666">-</span> <span style="color: #666666">1</span> <span style="color: #666666">&amp;</span> <span style="color: #666666">0x2</span>
    bc <span style="color: #666666">=</span> b <span style="color: #666666">&gt;&gt;</span> shift <span style="color: #666666">&amp;</span> <span style="color: #666666">0x1</span>
    <span style="color: #008000; font-weight: bold">return</span> rc <span style="color: #666666">|</span> gc <span style="color: #666666">|</span> bc
</code></pre></div></td></tr></table></div>
<p>The computation of the index combines bits from each of the red, green, and blue color components, starting at the top of the tree with the highest order bits. <code>Figure 4</code> shows the binary representation of the red, green, and blue components of 163, 98, 231. At the root of the tree we start with the most significant bit from each of the three color components; in this case the three bits are 1, 0, and 1. Putting these bits together we get binary 101 or decimal 5. You can see the binary manipulation of the red, green, and blue numbers in the <code>compute_index</code> method on line <code>line_otci</code> in <code>Listing lst_otninsert</code>.</p>
<p>The operators used in the <code>compute_index</code> may be unfamiliar to you. The <code>&gt;&gt;</code> operator is the right shift operation. The <code>&amp;</code> is bitwise <code>and</code>, and <code>|</code> is logical <code>or</code>. The bitwise <code>or</code> and bitwise <code>and</code> operations work just like the logical operations used in conditionals, except that they work on the individual bits of a number. The shift operation simply moves the bits <span class="arithmatex">\(n\)</span> places to the right, filling in with zeros on the left and dropping the bits as they go off the right.</p>
<p>Once we have computed the index appropriate for the current level of the tree, we traverse down into the subtree. In the example in <code>Figure 4</code> we follow the link at position 5 in the <code>children</code> array. If there is no node at position 5, we create one. We keep traversing down the tree until we get to <code>max_level</code>. At <code>max_level</code> we stop searching and store the data. Notice that we do not overwrite the data in the leaf node, but rather we add the color components to any existing components and increment the reference counter. This allows us to compute the average of any color below the current node in the color cube. In this way, a leaf node in the <code>octree</code> may represent a number of similar colors in the color cube.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/octreeIndex.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/octreeIndex.png" /></a>
    <figcaption markdown="span">Figure 4: Computing an Index to Insert a Node in an octree</figcaption>
</figure></p>
<p>The <code>find</code> method, shown in <code>Listing lst_otnfind</code>, uses the same method of index computation as the <code>insert</code> method to traverse the tree in search of a node matching the red, green, and blue components. </p>
<div class="language-python highlight" style="background: #f8f8f8"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Listing lst_otnfind</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 1</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 2</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 3</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 4</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 5</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 6</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 7</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 8</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"> 9</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">10</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">11</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">12</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">13</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">14</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">15</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">16</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">17</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">18</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">19</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">20</span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;">21</span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">find</span>(<span style="color: #008000">self</span>, r, g, b, level):
    <span style="color: #008000; font-weight: bold">if</span> level <span style="color: #666666">&lt;</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>oTree<span style="color: #666666">.</span>max_level:
        idx <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>compute_index(r, g, b, level)
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx]:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children[idx]<span style="color: #666666">.</span>find(
                r, g, b, level <span style="color: #666666">+</span> <span style="color: #666666">1</span>
            )
        <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
            <span style="color: #008000; font-weight: bold">return</span> (
                <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
                <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
                <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
            )
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot;No leaf node to represent this color&quot;</span>)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">return</span> (
            <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
            <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
            <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">//</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count,
        )
</code></pre></div></td></tr></table></div>
<p>The <code>find</code> method has three exit conditions:</p>
<ol>
<li>We have reached the maximum level of the tree and so we return the average of the color information stored in this leaf node (see lines 17--21).</li>
<li>We have found a leaf node at a height less than <code>max_level</code> (see lines 9--13). This is possible only after the tree has been reduced. See below.</li>
<li>We try to follow a path into a nonexistent subtree, which is an error.</li>
</ol>
<p>The final aspect of the <code>OTNode</code> class is the <code>merge</code> method. It allows a parent to subsume all of its children and become a leaf node itself. If you remember back to the structure of the <code>octree</code> where each parent cube fully encloses all the cubes represented by the children, you will see why this makes sense. When we merge a group of siblings we are effectively taking a weighted average of the colors represented by each of those siblings. Since all the siblings are relatively close to each other in color space, the average is a good representation of all of them. <code>Figure 5</code> illustrates the merge process for some sibling nodes.</p>
<p><figure markdown="span">
    <a class="glightbox" href="../imgs/otMerge.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Image title" src="../imgs/otMerge.png" /></a>
    <figcaption markdown="span">Figure 5: Merging Four Leaf Nodes of an <code>octree</code></figcaption>
</figure></p>
<p><code>Figure 5</code> shows the red, green, and blue components represented by the four leaf nodes whose identifying color values are (101, 122, 167), (100, 122, 183), (123, 108, 163), and (126, 113, 166). As you can see in <code>Listing lst_otnfind</code>the identifying values are calculated dividing the color values by the count. Notice how close they are in the overall color space. The leaf node that gets created from all of these has an ID of (112, 115, 168). This is close to the average of the four, but weighted more towards the third color tuple due to the fact that it had a reference count of 12.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">merge</span>(<span style="color: #008000">self</span>):
    <span style="color: #008000; font-weight: bold">for</span> child <span style="color: #AA22FF; font-weight: bold">in</span> [c <span style="color: #008000; font-weight: bold">for</span> c <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>children <span style="color: #008000; font-weight: bold">if</span> c]:
        <span style="color: #008000; font-weight: bold">if</span> child<span style="color: #666666">.</span>count <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
            <span style="color: #008000">self</span><span style="color: #666666">.</span>o_tree<span style="color: #666666">.</span>all_leaves<span style="color: #666666">.</span>remove(child)
            <span style="color: #008000">self</span><span style="color: #666666">.</span>o_tree<span style="color: #666666">.</span>num_leaves <span style="color: #666666">-=</span> <span style="color: #666666">1</span>
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot;Recursively merging non-leaf...&quot;</span>)
            child<span style="color: #666666">.</span>merge()
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>count
        <span style="color: #008000">self</span><span style="color: #666666">.</span>red <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>red
        <span style="color: #008000">self</span><span style="color: #666666">.</span>green <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>green
        <span style="color: #008000">self</span><span style="color: #666666">.</span>blue <span style="color: #666666">+=</span> child<span style="color: #666666">.</span>blue
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">8</span>):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>children[i] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>
</code></pre></div>
<p>Because the <code>octree</code> uses only colors that are really present in the image and faithfully preserves colors that are often used, the final quantized image from the <code>octree</code> is much higher quality than the simple method we used to start this section. <code>Figure 2</code> shows a comparison of the original image with the quantized image.</p>
<p>There are many additional ways to compress images using techniques such as run-length encoding, discrete cosine transform, and Huffman coding. Any of these algorithms are within your grasp and we encourage you to look them up and read about them. In addition, quantized images can be improved by using a technique known as <strong>dithering</strong>. Dithering is a process by which different colors are placed near each other so that the eye blends the colors together, forming a more realistic image. This is an old trick used by newspapers for doing color printing using just black plus three different colors of ink. Again you can research dithering and try to apply it to some images on your own.</p>
</div>
</div>
</div>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月12日</span>
      
        <br>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月9日</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "content.tabs.link", "content.code.copy", "content.tooltips", "navigation.indexes", "navigation.prune", "navigation.instant"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>